\documentclass[aspectratio=169,11pt,hyperref={colorlinks=true}]{beamer}
\usetheme{boxes}
\setbeamertemplate{navigation symbols}{}
\definecolor{ibm}{RGB}{70,107,176}
\setbeamercolor{titlelike}{fg=ibm}
\setbeamercolor{structure}{fg=ibm}
\hypersetup{colorlinks,urlcolor=ibm}
\setbeamertemplate{footline}[frame number]
% Inserting graphics
\usepackage{graphicx}
% Side-by-side figures, etc
\usepackage{subfigure}
% Code snippits
\usepackage{listings}

\usepackage{lmodern}
% Color stuff
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{empheq}
\usepackage[braket, qm]{qcircuit}
\usepackage{tikz}
\usepackage{gensymb}
\newcommand\RBox[1]{%
  \tikz\node[draw,rounded corners,align=center,] {#1};%
}
\usepackage{hyperref}
%\usecolortheme{buzz}
%\usecolortheme{wolverine}
%\usetheme{Boadilla}
\usepackage[T1]{fontenc}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{%
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{ibm},  % comment style
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
%  otherkeywords={*,...},           % if you want to add more keywords to the set
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stringstyle=\color{ibm},   % string literal style
}


\setbeamerfont{caption}{series=\normalfont,size=\fontsize{6}{8}}
\setbeamertemplate{caption}{\raggedright\insertcaption\par}

\setlength{\abovecaptionskip}{0pt}
\setlength{\floatsep}{0pt}

\author[Matthew Treinish]{%
    \texorpdfstring{%
        \centering
        Matthew Treinish\\
        Software Engineer - IBM Research\\
        \href{mailto:mtreinish@kortar.org}{mtreinish@kortar.org}\\
        \texttt{mtreinish on Freenode}\\
        \href{https://github.com/mtreinish/quantum-compilers}{https://github.com/mtreinish/quantum-compilers}
   }
   {Matthew Treinish}
}
\date{January 17, 2020}

\title{Building a Compiler for Quantum Computers}
\begin{document}

\titlepage
\section{How to Program Quantum Computers}
\subsection{Quantum Circuits}
\begin{frame}
    \frametitle{Quantum Circuits}
    \begin{columns}
        \column{0.5\textwidth}
            \begin{itemize}
                \item 
            \end{itemize}
        \column{0.5\textwidth}
            \begin{equation*}
                \Qcircuit @C=1.0em @R=0.0em @!R {
            	 	\lstick{ q_{0} : \ket{0} } & \gate{H} & \ctrl{1} & \meter & \qw & \qw & \qw\\
            	 	\lstick{ q_{1} : \ket{0} } & \qw & \targ & \qw & \meter & \qw & \qw\\
            	 	\lstick{c_{0}: 0} & \cw & \cw & \cw \cwx[-2] & \cw & \cw & \cw\\
            	 	\lstick{c_{1}: 0} & \cw & \cw & \cw & \cw \cwx[-2] & \cw & \cw\\
            	}
            \end{equation*}
    \end{columns}
\end{frame}
\subsubsection{Quantum Gates}
\begin{frame}
    \frametitle{Quantum Gates}
    \begin{itemize}
        \item Quantum gates
        \item Gates are reversible
        \item Each gate can be represented as a unitary matrix
    \end{itemize}
    \includegraphics[width=.85\textwidth]{gate_h_bloch.png}
\end{frame}

%\renewcommand{\arraystretch}{4}
%
%\begin{frame}
%    \begin{tabular}{|*2{>{\renewcommand{\arraystretch}{1}}c|}}
%        Pauli-X gate & $\Qcircuit @C=0.5em @R=0.0em @!R { \lstick{} & \gate{X} & \qw & \qw\\ }$ & \begin{array}{cc} 0 & 1 \\ 1 & 0 \end{array} \\
%        Pauli-Y gate & $\Qcircuit @C=0.5em @R=0.0em @!R { \lstick{} & \gate{y} & \qw & \qw\\ }$ & \begin{array}{cc} 0 & -i \\ i & 0 \end{array} \\
%        Pauli-Z gate & $\Qcircuit @C=0.5em @R=0.0em @!R { \lstick{} & \gate{Z} & \qw & \qw\\ }$ & \begin{array}{cc} 1 & 0 \\ 0 & -1 \end{array} \\
%        Hadamard & $\Qcircuit @C=0.5em @R=0.0em @!R {\lstick{} & \gate{H} & \qw & \qw\\ }$ & $\frac{1}{\sqrt{2}}$ \begin{array}{cc} 1 & 1 \\ 1 & -1 \end{array}\\
%    \end{tabular}
%\end{frame}

\subsubsection{OpenQASM}
\begin{frame}
    \frametitle{OpenQASM\footnotemark[1]\footnotemark[2]}
    \begin{columns}
        \column{0.5\textwidth}
            \lstinputlisting{bell.qasm}
        \column{0.5\textwidth}
            \begin{itemize}
                \item Open Quantum Assembly Language
                \item An option
                \item Mostly used as a transport layer to save circuits
                    or share circuits
            \end{itemize}
    \end{columns}
    \footnotetext[1]{\href{https://arxiv.org/abs/1707.03429}{https://arxiv.org/abs/1707.03429}}
    \footnotetext[2]{\href{https://github.com/Qiskit/openqasm}{https://github.com/Qiskit/openqasm}}
\end{frame}

\subsection{Pulse}
\begin{frame}
    \frametitle{Pulse Level Programming}
    \begin{columns}
        \column{0.5\textwidth}
            \includegraphics[width=\textwidth]{bell-sched.png}
        \column{0.5\textwidth}
            \begin{itemize}
                \item A layer below the circuit model is to use pulses
                \item Each quantum gate is defined as a pulse that gets
                    applied to the qubits
                \item Enables you to tweak the definition of gates
                \item Mostly used for physics research or hardware characterization
            \end{itemize}
    \end{columns}
\end{frame}

\section{Constraints for Running on Quantum Computers}
\subsection{Qubit Connectivity}
\begin{frame}
    \frametitle{Qubit Connectivity}
    \begin{columns}
        \column{.5\textwidth}
            \begin{itemize}
                \item Qubits in a device have limited connectivity
                \item For multi-qubit gates this means we can only run them
                    between those qubits
                \item Need to use SWAP gates to move state around
            \end{itemize}
        \column{.5\textwidth}
            \centering
            \only<1>{\textbf{IBM Q 5 Yorktown}\\}
            \only<1>{\includegraphics[width=\textwidth]{ibmqx2-labeled.png}}
            \only<2>{\textbf{IBM Q 53 Rochester Coupling Map}\\}
            \only<2>{\includegraphics[width=\textwidth]{rochester_map.png}}
    \end{columns}
\end{frame}
\begin{frame}
    \frametitle{Mapping}
    \begin{equation*}
        \Qcircuit @C=1.0em @R=0.0em @!R {
    	 	\lstick{ {q0}_{0} : \ket{0} } & \gate{H} & \qw & \ctrl{4} & \gate{H} & \qw & \qw & \qw & \qw & \qw\\
    	 	\lstick{ {q0}_{1} : \ket{0} } & \gate{H} & \qw & \qw & \ctrl{3} & \gate{H} & \qw & \qw & \qw & \qw\\
    	 	\lstick{ {q0}_{2} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \ctrl{2} & \gate{H} & \qw & \qw & \qw\\
    	 	\lstick{ {q0}_{3} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \qw & \ctrl{1} & \gate{H} & \qw & \qw\\
    	 	\lstick{ {q0}_{4} : \ket{0} } & \gate{X} & \gate{H} & \targ & \targ & \targ & \targ & \gate{H} & \qw & \qw\\
    	 }
    \end{equation*}

    \begin{equation*}
    \Qcircuit @C=1.0em @R=0.0em @!R {
	 	\lstick{ {q}_{0} : \ket{0} } & \gate{H} & \qswap & \qw & \qw & \qw & \qw & \qw & \qswap & \qw & \qw & \qw & \qw & \qw\\
	 	\lstick{ {q}_{1} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \qswap & \qw & \qw & \qw & \qw & \qw & \qw & \qw & \qw\\
	 	\lstick{ {q}_{2} : \ket{0} } & \gate{H} & \qswap \qwx[-2] & \ctrl{2} & \gate{H} & \qswap \qwx[-1] & \ctrl{2} & \gate{H} & \qswap \qwx[-2] & \ctrl{2} & \gate{H} & \qw & \qw & \qw\\
	 	\lstick{ {q}_{3} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \qw & \qw & \qw & \qw & \qw & \ctrl{1} & \gate{H} & \qw & \qw\\
	 	\lstick{ {q}_{4} : \ket{0} } & \gate{X} & \gate{H} & \targ & \qw & \qw & \targ & \qw & \qw & \targ & \targ & \gate{H} & \qw & \qw\\
	 }
\end{equation*}

\begin{equation*}
    \Qcircuit @C=1.0em @R=0.0em @!R {
	 	\lstick{ {q}_{0} : \ket{0} } & \gate{X} & \gate{H} & \targ & \qswap & \gate{H} & \qw & \qw & \qw & \qw & \qw & \qw\\
	 	\lstick{ {q}_{1} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \qw & \qw & \qw & \ctrl{1} & \gate{H} & \qw & \qw\\
	 	\lstick{ {q}_{2} : \ket{0} } & \gate{H} & \qswap \qwx[2] & \ctrl{-2} & \qswap \qwx[-2] & \targ & \qw & \targ & \targ & \gate{H} & \qw & \qw\\
	 	\lstick{ {q}_{3} : \ket{0} } & \gate{H} & \qw & \qw & \qw & \ctrl{-1} & \gate{H} & \qw & \qw & \qw & \qw & \qw\\
	 	\lstick{ {q}_{4} : \ket{0} } & \gate{H} & \qswap & \qw & \qw & \qw & \qw & \ctrl{-2} & \gate{H} & \qw & \qw & \qw\\
	 }
\end{equation*}


\end{frame}
\subsection{Other Device Characteristics}
\begin{frame}
    \frametitle{Basis Gates}

\end{frame}
\begin{frame}
    \frametitle{Unrolling}

\end{frame}
\subsection{Noise}
\begin{frame}

\end{frame}

\section{Qiskit's Compiler}
\begin{frame}
    \frametitle{Qiskit Terra\footnotemark[1]}
    \begin{columns}
          \column{.5\textwidth}
             \begin{itemize}
                  \item Is the base layer for working with quantum computers provides interface to hardware and simulators
                  \item Provides an SDK for working with quantum circuits
                  \item Compiles circuits to run on different backends
                  \item Designed to be backend agnostic and work with any
                      quantum hardware or simulator
                  \item Written in Python
                  \item Apache 2.0 Licensed
             \end{itemize}
          \column{.5\textwidth}
              \centering
              \colorbox{black}{\includegraphics[width=.5\textwidth]{qiskit-terra-logo.png}}
      \end{columns}
      \footnotetext[1]{\href{https://github.com/Qiskit/qiskit-terra}{https://github.com/Qiskit/qiskit-terra}}
  \end{frame}

\subsection{The DAG}
\begin{frame}
    \frametitle{The DAG}
        \begin{columns}
            \column{0.45\textwidth}
                \begin{itemize}
                    \item Compiler represents circuits as a DAG
                    \item Each node in the DAG is an operation, an input, or
                          an output
                    \item Each edge indicates data flow between nodes
                    \item Makes flow of information between operations
                        explicit
                \end{itemize}
            \column{0.45\textwidth}
                \centering
                \includegraphics[width=0.75\textwidth]{bell-dag.png}
        \end{columns}
\end{frame}

\begin{frame}
    \begin{columns}
        \column{0.45\textwidth}
            \centering
            \begin{equation*}
                \Qcircuit @C=1.0em @R=0.0em @!R {
            	 	\lstick{ {q}_{0} : \ket{0} } & \gate{H} & \ctrl{1} & \meter & \qw & \qw & \qw\\
                	\lstick{ {q}_{1} : \ket{0} } & \qw & \targ & \qw & \gate{R_z(0.5)} & \qw & \qw\\
                	\lstick{ {q}_{2} : \ket{0} } & \qw & \qw & \qw & \qw & \qw & \qw\\
                	\lstick{c_{0}: 0} & \cw & \cw & \cw \cwx[-3] & \controlo \cw \cwx[-2] & \cw & \cw\\
                	\lstick{c_{1}: 0} & \cw & \cw & \cw & \control \cw \cwx[-1] & \cw & \cw\\
                	\lstick{c_{2}: 0} & \cw & \cw & \cw & \controlo \cw \cwx[-1] & \cw & \cw\\
                }
            \end{equation*}
        \column{.01\textwidth}
            \centering
            $\rightarrow$
        \column{0.45\textwidth}
            \centering
            \includegraphics[width=0.75\textwidth]{classical_dep_dag.png}
        \end{columns}
\end{frame}
{
\setbeamercolor{background canvas}{bg=black}
\setbeamercolor{footline}{fg=ibm}
\begin{frame}
    \includegraphics[width=\textwidth]{passmanager.png}
\end{frame}

\begin{frame}
    \includegraphics[width=\textwidth]{passmanager_2.png}
\end{frame}
}
\begin{frame}
    \frametitle{Passmanager Stages}
    \begin{columns}
        \column{.45\textwidth}
            \begin{itemize}
                \item Stages
                    \begin{itemize}
                        \item Logical Reductions
                        \item Embedding
                            \begin{itemize}
                                \item Layout
                                \item Mapping/Routing
                                \item Unrolling
                            \end{itemize}
                        \item Physical Reductions
                    \end{itemize}
                \item Pluggable and extensible
            \end{itemize}
        \column{.45\textwidth}
            \includegraphics[width=\textwidth]{passmanager_stages.png}
    \end{columns}
\end{frame}
\subsection{Preset Pass Managers}


\section{Passes}
\subsection{Unroller}
\begin{frame}
    \frametitle{The Unroller}
\end{frame}

\subsection{Layout}
\begin{frame}
    \frametitle{Layout}
    \begin{columns}
        \column{.45\textwidth}
            \begin{itemize}
                \item Initial mapping to physical qubits
                \item Multiple options included
                    \begin{itemize}
                        \item \href{https://github.com/Qiskit/qiskit-terra/blob/master/qiskit/transpiler/passes/layout/trivial\_layout.py}{TrivialLayout}
                        \item \href{https://github.com/Qiskit/qiskit-terra/blob/master/qiskit/transpiler/passes/layout/dense\_layout.py}{DenseLayout}
                        \item \href{https://github.com/Qiskit/qiskit-terra/blob/master/qiskit/transpiler/passes/layout/noise\_adaptive\_layout.py}{NoiseAdaptiveLayout}
                    \end{itemize}
            \end{itemize}
        \column{.45\textwidth}
            \centering
            \includegraphics[width=1.1\textwidth]{layout.png}
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{Layout Example}
    \begin{columns}
        \column{.45\textwidth}
            \centering
            \textbf{Logical Circuit}
            \includegraphics[width=\textwidth]{no_layout.png}
        \column{.45\textwidth}
            \centering
            \textbf{Target Device}
            \only<1>{\includegraphics[width=\textwidth]{ibmqx2-labeled.png}}
            \only<2>{\includegraphics[width=\textwidth]{layout_device.png}}
    \end{columns}
\end{frame}


\begin{frame}
    \begin{columns}
        \column{.5\textwidth}
            \centering
            optimization\_level=1\\
            TrivialLayout\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_1.png}\\
            optimization\_level=2\\
            DenseLayout\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_2.png}

        \column{.5\textwidth}
            \centering
            optimization\_level=3\\
            NoiseAdaptiveLayout\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_3.png}\\
            Custom Layout\\
            (optimization\_level=1)\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{custom_layout.png}
    \end{columns}
\end{frame}

\begin{frame}
    \begin{columns}
        \column{.5\textwidth}
            \centering
            optimization\_level=1\\
            TrivialLayout\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_1_results.png}\\
            optimization\_level=2\\
            DenseLayout\\
        \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_2_results.png}

        \column{.5\textwidth}
            \centering
            optimization\_level=3\\
            NoiseAdaptiveLayout\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{layout_3_results.png}\\
            Custom Layout\\
            (optimization\_level=1)\\
            \includegraphics[width=\linewidth, height=.4\textheight, keepaspectratio]{custom_layout_results.png}
    \end{columns}
\end{frame}
\subsection{Analysis Pass}
{
\setbeamercolor{background canvas}{bg=black}
\setbeamercolor{footline}{fg=ibm}
\begin{frame}
    \includegraphics[width=\textwidth]{block_collection.png}
\end{frame}
}

\subsection{Optimization Passes}
\subsubsection{Consolidate Blocks}
\begin{frame}
    \frametitle{Consolidate Blocks}
    \begin{enumerate}
        \item Loop over 2Q blocks collecteds from analysis pass
        \item Run a simulation to find unitary matrix of each block
        \item Replace block with unitary matrix
    \end{enumerate}
    \begin{center}
    \vspace{3em}
    \only<1>{
        \begin{equation*}
            \Qcircuit @C=1.0em @R=1.0em @!R {
                \lstick{ {q0}_{0} : \ket{0} } & \multigate{1}{unitary} & \multigate{2}{unitary} & \qw & \qw\\
                \lstick{ {q0}_{1} : \ket{0} } & \ghost{unitary} & \ghost{unitary} & \qw & \qw\\
                \lstick{ {q0}_{2} : \ket{0} } & \qw & \ghost{unitary} & \qw & \qw\\
            }
        \end{equation*}
    }
    \only<2>{\includegraphics[width=\textwidth]{unrolled_unitary.png}}
\end{center}
\end{frame}

\subsubsection{Optimize 1Q operations}
\begin{frame}
    \frametitle{Optimize 1Q Operations}
    \begin{itemize}
        \item For each run of single qubit gates find end state of rotations
    \end{itemize}
\end{frame}

\subsection{Device Mapping}

\section{Conclusions}
\subsection{Quantum Volume}
\begin{frame}
    \frametitle{Quantum Volume\footnotemark[1]}

    \vspace{3em}
    \footnotetext[1]{\href{https://arxiv.org/abs/1811.12926}{https://arxiv.org/abs/1811.12926}}
\end{frame}
\begin{frame}
    \frametitle{Conclusions}
    \begin{itemize}
        \item similar but different
    \end{itemize}
\end{frame}

\section{Questions?}
\begin{frame}
\frametitle{Where to get more information}
    \begin{itemize}
        \item These Slides: \href{https://github.com/mtreinish/quantum-compilers}{https://github.com/mtreinish/quantum-compilers}
        \item Qiskit: \href{https://qiskit.org/}{https://qiskit.org/}
        \item Qiskit Terra on Github: \href{https://github.com/Qiskit/qiskit-terra}{https://github.com/Qiskit/qiskit-terra}
        \item IBM Q Experience: \href{https://quantum-computing.ibm.com}{https://quantum-computing.ibm.com}
        \item Tutorials on Quantum Computing and Qiskit: \href{https://github.com/Qiskit/qiskit-tutorials}{https://github.com/Qiskit/qiskit-tutorials}
    \end{itemize}
\end{frame}

\section{Backup Slides}
\begin{frame}[noframenumbering]
    \frametitle{BACKUP SLIDES}
\end{frame}

\end{document}
